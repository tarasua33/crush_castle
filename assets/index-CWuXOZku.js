var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{r as s}from"./phaser-UvlxNa5i.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var n=s();class i extends n.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class o extends n.Scene{constructor(){super("GameOver"),t(this,"camera"),t(this,"background"),t(this,"gameover_text")}create(){this.camera=this.cameras.main,this.camera.setBackgroundColor(16711680),this.background=this.add.image(512,384,"background"),this.background.setAlpha(.5),this.gameover_text=this.add.text(512,384,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.gameover_text.setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}}const a=2048,r=1536,l=175,c=1254.4,p=1638.4,h=1079.4-60,m=325,d=class e{constructor(){t(this,"_lvl",0),t(this,"maxEnemies",3),t(this,"lvlEnemies",1)}static getModel(){return e.instance||(e.instance=new e),e.instance}resetLvlEnemies(e){this.lvlEnemies=e}increaseLvl(){this._lvl++,this._lvl=this._lvl%3}get lvl(){return this._lvl}};t(d,"instance");let _=d;class g{constructor(){t(this,"_models"),this._models={enemyModel:_.getModel()}}}const u="COMPLETE",S="EXPLOSION";class y extends Phaser.Physics.Matter.Image{constructor(e,s,n,i){super(e.matter.world,s,n,i),t(this,"eventSignal",new Phaser.Events.EventEmitter),t(this,"_enemyPool"),t(this,"_scene"),t(this,"_spawnX",0),t(this,"_spawnY",0),this._scene=e,e.add.existing(this),e.matter.world.remove(this),e.matter.world.remove(this.body),this.body.gameObject=this}spawn(e,t,s,n){this.setTexture(s),this.setPosition(e,t),this.angle=0,this._spawnX=e,this._spawnY=t,this.visible=!0,this.active=!0,this._enemyPool=n,this._scene.matter.world.add(this.body)}checkTransform(){Phaser.Math.Distance.Between(this._spawnX,this._spawnY,this.x,this.y)>62&&this._destroy()}_destroy(){this.eventSignal.emit(S,[this.x,this.y]),this.setVelocity(0),this.setAngularSpeed(0),this.setAngularVelocity(0),this._enemyPool.killAndHide(this),this.visible=!1,this.active=!1;const e=this._scene;e.matter.world.remove(this),e.matter.world.remove(this.body)}hit(){this.active&&this._destroy()}}class w extends Phaser.Physics.Matter.Image{constructor(e,s,n,i){super(e.matter.world,s,n,i),t(this,"eventSignal",new Phaser.Events.EventEmitter),e.add.existing(this),e.matter.world.once("afterupdate",(()=>{this.setOnCollide(this._hit.bind(this))}))}_hit(e){const{bodyA:t,bodyB:s}=e,n=s.gameObject,i=t.gameObject;n instanceof y?n.hit():i instanceof y&&i.hit()}}class C extends g{}class b extends C{buildUi({scene:e}){const t=new w(e,m,h,"saw").setCircle(60).setBounce(.4).setMass(20);return t.setFrictionAir(.03),t.setScale(.5),t}}class f extends C{buildUi({scene:e}){const t=[];for(let s=0;s<8;s++){const s=e.matter.add.image(0,0,"brick_tile",void 0,{label:"block"}).setBody({type:"rectangle",width:96,height:32},{isSensor:!0});s.visible=!1,s.active=!1,s.setSensor(!0),s.setIgnoreGravity(!0),s.rotation=0,s.body.gameObject=s,e.matter.world.remove(s),e.matter.world.remove(s.body),t.push(s)}return t}}class P extends C{buildUi({scene:e}){const t=this._models.enemyModel.maxEnemies,s=e.add.group({classType:y,maxSize:t});for(let n=0;n<t;n++){const t=new y(e,0,0,"enemy");t.setScale(-1,1),t.setPosition(1686.4,1222.4),s.add(t),s.killAndHide(t)}return s}}class x extends C{buildUi({scene:e}){return e.add.particles(0,0,"spark",{x:0,y:0,speed:{min:-300,max:300},angle:{min:0,max:360},lifespan:1100,scale:{start:.5,end:0},alpha:{start:1,end:.75},gravityY:400,blendMode:"ADD",emitting:!1,tint:[16711680],quantity:50})}}class v extends C{buildUi({scene:e}){const t=e.add.image(1024,768,"gameBg");return t.setScale(2),t.setOrigin(.5),t}}class k extends C{buildUi({scene:e}){const t=[],s=e.add.tileSprite(1024,1190.4,512,128,"bgTile");return s.setOrigin(.5),e.matter.add.gameObject(s,{isStatic:!0,label:"mountains"}),t.push(s),t}}class E extends C{buildUi({scene:e}){const t=e.add.tileSprite(1024,1318.4,8192,128,"bgTile");return t.setOrigin(.5),e.matter.add.gameObject(t,{isStatic:!0,label:"ground"}),t}}class M extends Phaser.GameObjects.Container{constructor(){super(...arguments),t(this,"_slingshotPoint"),t(this,"_rope"),t(this,"_baseRopeHeight")}build(e){const{scene:t,topPart:s,bottomPart:n,slingshotPointConfig:i,ropeConfig:o}=e,a=new Phaser.GameObjects.Image(t,s.x,s.y,s.texture);a.setOrigin(s.anchor.x,s.anchor.y),a.setScale(s.scaleX||1,s.scaleY||1),this.add(a);const r=new Phaser.GameObjects.Image(t,n.x,a.height,n.texture);r.setOrigin(n.anchor.x,n.anchor.y),r.setScale(n.scaleX||1,n.scaleY||1),this.add(r);const l=this._rope=new Phaser.GameObjects.Image(t,o.x,o.y,o.texture);l.setOrigin(o.anchor.x,o.anchor.y),this._baseRopeHeight=l.height||1,l.setScale(o.scaleX||1,o.scaleY||1),this.add(l),(this._slingshotPoint=t.matter.add.image(i.x,i.y,i.texture,"",{isStatic:!0,isSensor:!0,render:{visible:!0}})).setScale(i.scaleX||1,i.scaleY||1)}get slingshotPoint(){return this._slingshotPoint}rotateSlingshotPoint(e){this._slingshotPoint.angle=3*e}rotateRope(e,t){const s=this._rope;s.angle=Phaser.Math.RadToDeg(e)-90;const n=t/this._baseRopeHeight;s.setScale(1,n)}}class O extends C{buildUi({scene:e}){const t=new M(e,m,h);return e.add.existing(t),t.build({scene:e,topPart:{texture:"slingshot_top",x:0,y:0,anchor:{x:.5,y:0}},bottomPart:{texture:"slingshot_bottom",x:0,y:0,anchor:{x:.5,y:0},scaleY:3.7},ropeConfig:{texture:"rope",x:0,y:0,anchor:{x:.5,y:0},scaleY:0},slingshotPointConfig:{texture:"slingshotPoint_point",x:m,y:h,anchor:{x:.5,y:.5},scaleX:2,scaleY:2}}),t}}class U extends g{buildUi(e){const{scene:t}=e,s=new E,n=new b,i=new O,o=new f,a=new v,r=new P,l=new x,c=new k;return{bg:a.buildUi({scene:t}),ground:s.buildUi({scene:t}),mountains:c.buildUi({scene:t}),bullet:n.buildUi({scene:t}),slingshotPoint:i.buildUi({scene:t}),bricks:o.buildUi({scene:t}),enemies:r.buildUi({scene:t}),explosionParticles:l.buildUi({scene:t})}}}class B{constructor(){t(this,"completeStepSignal",new Phaser.Events.EventEmitter),t(this,"_params"),t(this,"_models"),this._models={enemyModel:_.getModel()}}_onComplete(...e){console.log("complete",this),this.completeStepSignal.emit(u,...e)}forceComplete(){}}class D extends B{}class A{constructor(){t(this,"completeSteps",new Phaser.Events.EventEmitter),t(this,"_sequences"),t(this,"_stepByStepSteps",[]),t(this,"_awaitSteps",[]),t(this,"_permanentsSteps",[]),t(this,"_dynamicSteps",new Set),t(this,"_numPermanentsSteps",0),t(this,"_numConsequentsSteps",0),t(this,"_isForceComplete",!1)}start(e){this._isForceComplete=!1,this._dynamicSteps.clear(),this._sequences=e,this._playNextSequence()}addDynamicStep(e,t){this._dynamicSteps.add(e),console.log("start",e),e.completeStepSignal.once(u,this._onCompleteDynamicStep,this),e.start(t)}_onCompleteDynamicStep(e){this._dynamicSteps.has(e)&&this._dynamicSteps.delete(e)}_playNextSequence(){const e=this._sequences;if(e&&e.length>0){const e=this._sequences.shift();this._setUpSequence(e)}else this._onComplete()}_setUpSequence(e){this._numPermanentsSteps=0,this._stepByStepSteps=e.stepByStep,this._permanentsSteps=e.permanents,this._awaitSteps=e.awaitSteps,this._numConsequentsSteps=e.stepByStep.length,e.permanents.length>0&&this._setUpPermanentsSteps(e.permanents),e.awaitSteps.length>0&&this._setUpAwaitSteps(e.awaitSteps),this._playNextConsequentStep()}_setUpPermanentsSteps(e){for(let t=0;t<e.length;t++){this._numPermanentsSteps++;const s=e[t].step,n=e[t].params;console.log("start",s),s.completeStepSignal.once(u,this._onPermanentStepComplete,this),s.start(n)}}_setUpAwaitSteps(e){for(let t=0;t<e.length;t++){const s=e[t].step,n=e[t].params;console.log("start",s),s.start(n)}}_onPermanentStepComplete(){this._numPermanentsSteps--,0===this._numPermanentsSteps&&this._tryCompleteSequence()}_playNextConsequentStep(){const e=this._stepByStepSteps;if(this._numConsequentsSteps>0){const t=e.length-this._numConsequentsSteps,s=e[t].step,n=e[t].params;console.log("start",s),s.completeStepSignal.once(u,this._onConsequentStepComplete,this),s.start(n)}else this._completeAwaitSteps(),this._tryCompleteSequence()}_completeAwaitSteps(){for(const{step:e}of this._awaitSteps)e.forceComplete();this._awaitSteps=[]}_onConsequentStepComplete(){this._isForceComplete||(this._numConsequentsSteps--,this._playNextConsequentStep())}_tryCompleteSequence(){this._isForceComplete||0===this._numPermanentsSteps&&0===this._numConsequentsSteps&&this._playNextSequence()}_onComplete(){this._sequences=[],this._stepByStepSteps=[],this._permanentsSteps=[],this._awaitSteps=[];for(const e of this._dynamicSteps)e.completeStepSignal.removeAllListeners(),e.forceComplete();this._dynamicSteps.clear(),this.completeSteps.emit(u)}forceComplete(){this._isForceComplete=!0;for(const e of this._stepByStepSteps)e.step.completeStepSignal.removeAllListeners(),e.step.forceComplete();for(const e of this._permanentsSteps)e.step.completeStepSignal.removeAllListeners(),e.step.forceComplete();for(const e of this._awaitSteps)e.step.completeStepSignal.removeAllListeners(),e.step.forceComplete();this._onComplete()}}class L extends B{constructor(){super(),t(this,"_mng",new A),this._mng.completeSteps.on(u,this._onComplete,this)}}class T{constructor(){t(this,"permanents",[]),t(this,"awaitSteps",[]),t(this,"stepByStep",[])}addPermanent(e,t){this.permanents.push({step:e,params:t})}addAwaitPermanentStep(e,t){this.awaitSteps.push({step:e,params:t})}addStepByStep(e,t){this.stepByStep.push({step:e,params:t})}}class q extends B{start(e){this._params=e;const{scene:t,duration:s}=e;t.camera.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,this._onComplete,this),t.camera.fadeOut(s,6,252,255)}}class V extends B{start(e){this._params=e;const{bullet:t,enemyPool:s,bricks:n,scene:i}=e;for(const o of n)o.visible=!1,o.active=!1,o.x=0,o.y=0,o.setSensor(!0),o.setIgnoreGravity(!0),o.setVelocity(0),o.setAngularSpeed(0),o.setAngularVelocity(0),i.matter.world.remove(o),i.matter.world.remove(o.body);for(const o of s.getChildren())s.killAndHide(o),o.visible=!1,o.active=!1;t.setPosition(m,h),this._onComplete()}}class R extends L{constructor(){super(...arguments),t(this,"_hideLvlStep",new q),t(this,"_resetEnemyStep",new V)}start({gameView:e,scene:t}){const s=new T;s.addStepByStep(this._hideLvlStep,{scene:t,duration:500}),s.addStepByStep(this._resetEnemyStep,{scene:t,bullet:e.bullet,enemyPool:e.enemies,bricks:e.bricks}),this._mng.start([s])}}class N extends B{start(e){this._params=e;const{scene:t,duration:s,x:n,y:i}=e;t.camera.stopFollow(),s>0?(t.camera.once("camerazoomcomplete",this._onComplete,this),t.camera.pan(n,i,s,"Sine.easeInOut"),t.zoomTo(1,s,"Sine.easeInOut")):this._onComplete()}_onComplete(){const{scene:e,x:t,y:s}=this._params;e.camera.off("camerazoomcomplete",this._onComplete,this),e.camera.centerOn(t,s),e.setZoom(1),super._onComplete()}}class z extends B{start(e){this._params=e;const{scene:t,bullet:s,constraintComponent:n,slingshotPoint:i}=e;s.setPosition(m,h),s.setStatic(!1),n.createConstraint(s.body,i.slingshotPoint,t),this._onComplete()}}class I extends L{constructor(){super(...arguments),t(this,"_resetBulletStep",new z),t(this,"_moveOnTargetStep",new N)}start({gameView:e,scene:t,constraintComponent:s}){const n=new T;n.addStepByStep(this._resetBulletStep,{scene:t,bullet:e.bullet,constraintComponent:s,slingshotPoint:e.slingshotPoint}),n.addStepByStep(this._moveOnTargetStep,{scene:t,duration:1e3,x:1024,y:768}),this._mng.start([n])}}class j extends B{start(e){this._params=e;const{scene:t,duration:s}=e;t.camera.once(Phaser.Cameras.Scene2D.Events.FADE_IN_COMPLETE,this._onComplete,this),t.camera.fadeIn(s,6,252,255)}}class F extends B{start(e){this._params=e;const{bullet:t,scene:s,enemyPool:n,bricks:i,lvl:o}=e,a=o.castle;let r=0;for(const h of a){const e=i[r];e.rotation=h.rotation,e.setPosition(p+h.x,c+h.y),e.visible=!0,e.active=!0,e.setSensor(!1),e.setIgnoreGravity(!1),e.setVelocity(0),e.setAngularSpeed(0),e.setAngularVelocity(0),s.matter.world.add(e.body),r++}const l=o.enemies;for(let h=0;h<l.length;h++){const e=l[h];n.get().spawn(p+e.x,c+e.y,e.type,n)}t.setPosition(m,h),t.setStatic(!0),s.camera.stopFollow(),s.camera.centerOn(1024,768),s.setZoom(1),this._onComplete()}}class G extends L{constructor(){super(...arguments),t(this,"_showLvlStep",new j),t(this,"_spawnLvlStep",new F)}start({gameView:e,lvl:t,scene:s}){const n=new T;n.addStepByStep(this._spawnLvlStep,{scene:s,bullet:e.bullet,enemyPool:e.enemies,bricks:e.bricks,lvl:t}),n.addStepByStep(this._showLvlStep,{scene:s,duration:1e3}),this._mng.start([n])}}class H extends B{start(e){this._params=e;const{scene:t,delay:s}=e;t.time.delayedCall(s,this._onComplete,void 0,this)}}class Y extends B{start(e){this._params=e;const{scene:t}=e;t.matter.world.on("afterupdate",this._worldUpdate,this)}_worldUpdate(){const{bullet:e,constraintComponent:t}=this._params,s=t.getPosition();e.setPosition(s.x,s.y)}_onComplete(){this._params.scene.matter.world.off("afterupdate",this._worldUpdate,this),this._worldUpdate(),super._onComplete()}forceComplete(){this._onComplete()}}class W extends B{constructor(){super(...arguments),t(this,"targetEnemySignal",new Phaser.Events.EventEmitter)}start(e){this._params=e;const{scene:t,enemyPool:s}=e;for(const n of s.getChildren())n.active&&n.eventSignal.once(S,this._explosion,this);t.matter.world.on("afterupdate",this._worldUpdate,this)}_explosion(e){this.targetEnemySignal.emit(S),this._params.explosionParticles.explode(50,e[0],e[1])}_worldUpdate(){const e=this._params.scene.matter.world.localWorld.bodies,t=this._params.enemyPool;for(const n of t.getChildren())n.active&&n.checkTransform();let s=!1;for(const n of e)n.speed>.2&&(s=!0);s||this._onComplete()}_onComplete(){const{enemyPool:e}=this._params;for(const t of e.getChildren())t.active&&t.eventSignal.off(S,this._explosion,this);this._params.scene.matter.world.off("afterupdate",this._worldUpdate,this),super._onComplete()}}class X extends B{start(e){this._params=e;const{bullet:t,scene:s,duration:n}=e;s.camera.once("camerazoomcomplete",this._onComplete,this),s.camera.pan(t.x,t.y,n,"Sine.easeInOut"),s.zoomTo(1.2,n,"Sine.easeInOut")}_onComplete(){const{bullet:e,scene:t}=this._params;e.setAngularVelocity(-.5),t.camera.off("camerazoomcomplete",this._onComplete,this),t.camera.startFollow(e,!0,.1,.1),super._onComplete()}}class Z extends B{constructor(){super(...arguments),t(this,"_trashHold",3),t(this,"_previousDist",150)}start(e){const{bullet:t}=this._params=e,{scene:s,constraintComponent:n}=e;this._previousDist=185,e.scene.matter.world.removeConstraint(n.constraint);const i=t.body.velocity;t.setVelocity(Phaser.Math.Clamp(i.x,-70,70),Phaser.Math.Clamp(i.y,-70,70)),s.matter.world.on("afterupdate",this._worldUpdate,this)}_worldUpdate(){const{bullet:e}=this._params,t=this._params.slingshotPoint,s=this._params.slingshotPoint.slingshotPoint.body.position,n=Phaser.Math.Distance.Between(s.x,s.y,e.x,e.y),i=Math.atan2(e.y-s.y,e.x-s.x);this._params.bullet.body.speed&&this._params.bullet.body.speed>0&&(n<this._trashHold||n>this._previousDist)?(t.rotateSlingshotPoint(0),t.rotateRope(0,1),this._onComplete()):(t.rotateSlingshotPoint(n),t.rotateRope(i,n),this._previousDist=n)}_onComplete(){this._params.scene.matter.world.off("afterupdate",this._worldUpdate,this),super._onComplete()}}class K extends L{constructor(){super(...arguments),t(this,"_endStrikeStep",new W),t(this,"_startStrikeStep",new Z),t(this,"_awaitStep",new H),t(this,"_preparationStrikeStep",new X),t(this,"_awaitStrikeStep",new Y),t(this,"_isWin",!1)}start({gameView:e,scene:t,constraintComponent:s}){this._isWin=!1;const n=new T;n.addAwaitPermanentStep(this._awaitStrikeStep,{scene:t,bullet:e.bullet,constraintComponent:s}),n.addStepByStep(this._preparationStrikeStep,{scene:t,bullet:e.bullet,duration:1e3});const i=new T;i.addStepByStep(this._startStrikeStep,{scene:t,bullet:e.bullet,constraintComponent:s,slingshotPoint:e.slingshotPoint});const o=this._endStrikeStep;o.targetEnemySignal.on(S,this._onTarget,this),i.addStepByStep(o,{scene:t,enemyPool:e.enemies,explosionParticles:e.explosionParticles}),i.addStepByStep(this._awaitStep,{scene:t,delay:2e3}),this._mng.start([n,i])}_onTarget(){this._models.enemyModel.lvlEnemies--,this._models.enemyModel.lvlEnemies<=0&&(this._isWin=!0)}_onComplete(){this._endStrikeStep.targetEnemySignal.off(S,this._onTarget,this),super._onComplete(this._isWin)}}class J extends B{constructor(){super(...arguments),t(this,"_pointerComponent")}start(e){this._params=e;const{scene:t,pointerComponent:s}=e;this._pointerComponent=s,t.input.on("pointerdown",this._startDrag,this)}_startDrag(e){const t=e.positionToCamera(this._params.scene.cameras.main),s=this._params.bullet;Phaser.Math.Distance.Between(t.x,t.y,s.x,s.y)<100&&(this._pointerComponent.pointer=t,this._pointerComponent.startDrag(),this._onComplete())}_onComplete(){this._params.scene.input.off("pointerdown",this._startDrag,this),super._onComplete()}}class Q extends B{constructor(){super(...arguments),t(this,"_pointerComponent")}start(e){this._params=e;const{scene:t,pointerComponent:s}=e;this._pointerComponent=s,t.input.on("pointermove",this._onPointerMove,this),t.matter.world.on("afterupdate",this._onPhysicUpdate,this)}_onComplete(){const e=this._params.scene;e.input.off("pointermove",this._onPointerMove,this),e.matter.world.off("afterupdate",this._onPhysicUpdate,this),super._onComplete()}_onPhysicUpdate(){this._pointerComponent.isDragging&&this._pointerComponent.pointer&&this._onDrag(this._pointerComponent.pointer)}_onPointerMove(e){this._pointerComponent.isDragging&&(this._pointerComponent.pointer=e.positionToCamera(this._params.scene.cameras.main))}_onDrag(e){const t=e,s=this._params.slingshotPoint,n=this._params.slingshotPoint.slingshotPoint.body.position,{bullet:i,constraintComponent:o}=this._params,a=Phaser.Math.Distance.Between(n.x,n.y,t.x,t.y),r=Math.atan2(t.y-n.y,t.x-n.x);if(a<l)i.setPosition(t.x,t.y),o.setPosition(t.x,t.y),s.rotateSlingshotPoint(a),s.rotateRope(r,a);else{const e=Math.sin(r)*l,t=Math.cos(r)*l;i.setPosition(n.x+t,n.y+e),o.setPosition(n.x+t,n.y+e),s.rotateSlingshotPoint(l),s.rotateRope(r,l)}}forceComplete(){this._onComplete()}}class $ extends B{constructor(){super(...arguments),t(this,"_pointerComponent")}start(e){this._params=e;const{scene:t,pointerComponent:s}=e;this._pointerComponent=s,t.input.on("pointerup",this._release,this)}_release(){this._pointerComponent.isDragging&&(this._pointerComponent.endDrag(),this._pointerComponent.pointer=void 0,this._onComplete())}_onComplete(){this._params.scene.input.off("pointerup",this._release,this),super._onComplete()}}class ee extends L{constructor(){super(...arguments),t(this,"_awaitUserActionStep",new J),t(this,"_endDragStep",new $),t(this,"_dragActionStep",new Q),t(this,"_resetBulletStep",new z)}start({gameView:e,pointerComponent:t,constraintComponent:s,isFirst:n,scene:i}){const o=[];if(n){const t=new T;o.push(t),t.addStepByStep(this._resetBulletStep,{scene:i,bullet:e.bullet,constraintComponent:s,slingshotPoint:e.slingshotPoint})}const a=new T;o.push(a),a.addStepByStep(this._awaitUserActionStep,{scene:i,bullet:e.bullet,pointerComponent:t});const r=new T;o.push(r),r.addAwaitPermanentStep(this._dragActionStep,{scene:i,bullet:e.bullet,slingshotPoint:e.slingshotPoint,pointerComponent:t,constraintComponent:s}),r.addStepByStep(this._endDragStep,{scene:i,pointerComponent:t}),this._mng.start(o)}}class te extends D{constructor(){super(...arguments),t(this,"_userActionController",new ee),t(this,"_strikeController",new K),t(this,"_showLvlController",new G),t(this,"_resetRoundController",new I),t(this,"_hideLvlController",new R),t(this,"_firstRound",!0)}start(e){this._params=e,this._playShowLvl()}_playShowLvl(){const e=this._params.scene.cache.json.get("lvls")[this._models.enemyModel.lvl];this._models.enemyModel.resetLvlEnemies(e.targets);const{gameView:t,scene:s}=this._params;this._firstRound=!0;const n=this._showLvlController;n.completeStepSignal.once(u,this._playNextRound,this),n.start({gameView:t,scene:s,lvl:e})}_playStrike(){this._firstRound=!1;const e=this._strikeController;e.completeStepSignal.once(u,this._playResult,this);const{scene:t,gameView:s,constraintComponent:n}=this._params;e.start({scene:t,gameView:s,constraintComponent:n})}_playResult(e){e?this._hideLvl():this._resetRound()}_hideLvl(){console.log("WIN"),this._models.enemyModel.increaseLvl();const{gameView:e,scene:t}=this._params,s=this._hideLvlController;s.completeStepSignal.once(u,this._playShowLvl,this),s.start({gameView:e,scene:t})}_resetRound(){const{gameView:e,scene:t,constraintComponent:s}=this._params,n=this._resetRoundController;n.completeStepSignal.once(u,this._playNextRound,this),n.start({gameView:e,constraintComponent:s,scene:t})}_playNextRound(){const{gameView:e,pointerComponent:t,constraintComponent:s,scene:n}=this._params,i=this._userActionController;i.completeStepSignal.once(u,this._playStrike,this),i.start({gameView:e,pointerComponent:t,constraintComponent:s,scene:n,isFirst:this._firstRound})}}class se{constructor(){t(this,"pointer"),t(this,"_isDragging",!1)}startDrag(){this._isDragging=!0}endDrag(){this._isDragging=!1}get isDragging(){return this._isDragging}}class ne{constructor(){t(this,"_constraint"),t(this,"_pos")}createConstraint(e,t,s){return this._constraint=s.matter.add.constraint(e,t,0,.02),this._constraint}setPosition(e,t){this._pos=new Phaser.Math.Vector2(e,t)}getPosition(){return this._pos}get constraint(){return this._constraint}pauseUpdate(){}}class ie extends n.Scene{constructor(){super("Game"),t(this,"camera"),t(this,"_scale",1)}create(){this.camera=this.cameras.main,this.scale.on("resize",this.resize,this),this.resize({width:window.innerWidth,height:window.innerHeight}),this.add.rectangle(0,0,a,r,16777215).setOrigin(0),this._createGame()}_createGame(){const e=(new U).buildUi({scene:this}),t=new ne,s=new se;(new te).start({gameView:e,pointerComponent:s,constraintComponent:t,scene:this})}resize(e){const{width:t,height:s}=e,n=t,i=s,o=a,l=r,c=this._scale=Math.min(n/o,i/l);this.cameras.main.setZoom(c),this.cameras.main.centerOn(1024,768)}zoomTo(e,t,s){this.camera.zoomTo(this._scale*e,t,s)}setZoom(e){this.cameras.main.setZoom(this._scale*e)}}class oe extends n.Scene{constructor(){super("MainMenu"),t(this,"background"),t(this,"logo"),t(this,"title")}create(){this.background=this.add.image(512,384,"background"),this.logo=this.add.image(512,300,"logo"),this.title=this.add.text(512,460,"Main Menu",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("Game")}))}}class ae extends n.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const e=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(t=>{e.width=4+460*t}))}preload(){this.load.json("lvls","data/lvls.json"),this.load.setPath("assets"),this.load.image("gameBg","game/sky.png"),this.load.image("logo","logo.png"),this.load.image("bgTile","game/GrassCliffMid.png"),this.load.image("saw","game/Saw.png"),this.load.image("brick_tile","game/brick_tile.png"),this.load.image("slingshot_bottom","game/slingshotPoint_b.png"),this.load.image("slingshot_top","game/slingshotPoint_t.png"),this.load.image("slingshotPoint_point","game/slingshotPoint_point.png"),this.load.image("rope","game/rope.png"),this.load.image("chest","game/chest.png"),this.load.image("enemy","game/enemy.png"),this.load.image("mace","game/Mace.png"),this.load.image("spark","game/spark.png")}create(){this.scene.start("MainMenu")}}const re={type:n.AUTO,width:a,height:r,parent:"game-container",backgroundColor:"#028af8",physics:{default:"matter",matter:{gravity:{y:1,x:0},debug:!0}},scene:[i,ae,oe,ie,o],scale:{mode:Phaser.Scale.NONE,autoCenter:Phaser.Scale.NO_CENTER}};document.addEventListener("DOMContentLoaded",(()=>{(()=>{const e=new n.Game({...re,parent:"game-container"});e.scale.resize(window.innerWidth,window.innerHeight),window.addEventListener("resize",(()=>{e.scale.resize(window.innerWidth,window.innerHeight)}))})()}));
