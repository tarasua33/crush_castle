var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{r as s}from"./phaser-UvlxNa5i.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var n=s();class o extends n.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class i extends n.Scene{constructor(){super("GameOver"),t(this,"camera"),t(this,"background"),t(this,"gameover_text")}create(){this.camera=this.cameras.main,this.camera.setBackgroundColor(16711680),this.background=this.add.image(512,384,"background"),this.background.setAlpha(.5),this.gameover_text=this.add.text(512,384,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.gameover_text.setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}}const a=2048,r=1536,l=150,c=1254.4,p=1433.6,h=1044.4,m=400,d=class e{constructor(){t(this,"maxEnemies",3),t(this,"lvlEnemies",3)}static getModel(){return e.instance||(e.instance=new e),e.instance}resetLvlEnemies(){this.lvlEnemies=3}};t(d,"instance");let _=d;class g{constructor(){t(this,"_models"),this._models={enemyModel:_.getModel()}}}class u extends g{}class S extends u{buildUi({scene:e}){const t=e.matter.add.image(m,h,"saw").setCircle(60).setBounce(.4);return t.setFrictionAir(.03),t.setScale(.5),t}}class w extends u{buildUi({scene:e}){const t=e.cache.json.get("castles"),s=[];for(const n of t){const t=e.matter.add.image(p+n.x,c+n.y,"brick_tile",void 0,{label:"block"}).setBody({type:"rectangle",width:96,height:32});t.rotation=n.rotation,s.push(t)}return s}}const y="COMPLETE",C="EXPLOSION";class f extends Phaser.Physics.Matter.Image{constructor(e,s,n,o){super(e.matter.world,s,n,o),t(this,"eventSignal",new Phaser.Events.EventEmitter),t(this,"_scene"),t(this,"_spawnX",0),t(this,"_spawnY",0),this._scene=e,e.add.existing(this),e.matter.world.remove(this),e.matter.world.remove(this.body)}spawn(e,t,s){this.setTexture(s),this.setPosition(e,t),this.angle=0,this._spawnX=e,this._spawnY=t,this.visible=!0,this.active=!0,console.log("@@@ --- ","SPAWN"),this._scene.matter.world.add(this.body)}checkTransform(e){if(Phaser.Math.Distance.Between(this._spawnX,this._spawnY,this.x,this.y)>62){this.eventSignal.emit(C,[this.x,this.y]),e.killAndHide(this),this.visible=!1,this.active=!1;const t=this._scene;t.matter.world.remove(this),t.matter.world.remove(this.body)}}}class x extends u{buildUi({scene:e}){const t=this._models.enemyModel.maxEnemies,s=e.add.group({classType:f,maxSize:t});for(let n=0;n<t;n++){const t=new f(e,0,0,"enemy");t.setScale(-1,1),t.setPosition(1481.6,1222.4),s.add(t),s.killAndHide(t)}return s}}class P extends u{buildUi({scene:e}){return e.add.particles(0,0,"spark",{x:0,y:0,speed:{min:-300,max:300},angle:{min:0,max:360},lifespan:1100,scale:{start:.5,end:0},alpha:{start:1,end:.75},gravityY:400,blendMode:"ADD",emitting:!1,tint:[16711680],quantity:50})}}class b extends u{buildUi({scene:e}){const t=e.add.image(1024,768,"gameBg");return t.setScale(2),t.setOrigin(.5),t}}class v extends u{buildUi({scene:e}){const t=e.add.tileSprite(1024,1318.4,4096,128,"bgTile");return t.setOrigin(.5),e.matter.add.gameObject(t,{isStatic:!0,label:"ground"}),t}}class k extends Phaser.GameObjects.Container{constructor(){super(...arguments),t(this,"_slingshotPoint"),t(this,"_rope"),t(this,"_baseRopeHeight")}build(e){const{scene:t,topPart:s,bottomPart:n,slingshotPointConfig:o,ropeConfig:i}=e,a=new Phaser.GameObjects.Image(t,s.x,s.y,s.texture);a.setOrigin(s.anchor.x,s.anchor.y),a.setScale(s.scaleX||1,s.scaleY||1),this.add(a);const r=new Phaser.GameObjects.Image(t,n.x,a.height,n.texture);r.setOrigin(n.anchor.x,n.anchor.y),r.setScale(n.scaleX||1,n.scaleY||1),this.add(r);const l=this._rope=new Phaser.GameObjects.Image(t,i.x,i.y,i.texture);l.setOrigin(i.anchor.x,i.anchor.y),this._baseRopeHeight=l.height||1,l.setScale(i.scaleX||1,i.scaleY||1),this.add(l),(this._slingshotPoint=t.matter.add.image(o.x,o.y,o.texture,"",{isStatic:!0,isSensor:!0,render:{visible:!0}})).setScale(o.scaleX||1,o.scaleY||1)}get slingshotPoint(){return this._slingshotPoint}rotateSlingshotPoint(e){this._slingshotPoint.angle=3*e}rotateRope(e,t){const s=this._rope;s.angle=Phaser.Math.RadToDeg(e)-90;const n=t/this._baseRopeHeight;s.setScale(1,n)}}class E extends u{buildUi({scene:e}){const t=new k(e,m,h);return e.add.existing(t),t.build({scene:e,topPart:{texture:"slingshot_top",x:0,y:0,anchor:{x:.5,y:0}},bottomPart:{texture:"slingshot_bottom",x:0,y:0,anchor:{x:.5,y:0},scaleY:3.7},ropeConfig:{texture:"rope",x:0,y:0,anchor:{x:.5,y:0},scaleY:0},slingshotPointConfig:{texture:"slingshotPoint_point",x:m,y:h,anchor:{x:.5,y:.5},scaleX:2,scaleY:2}}),t}}class M extends g{buildUi(e){const{scene:t}=e,s=new v,n=new S,o=new E,i=new w,a=new b,r=new x,l=new P;return{bg:a.buildUi({scene:t}),ground:s.buildUi({scene:t}),bullet:n.buildUi({scene:t}),slingshotPoint:o.buildUi({scene:t}),bricks:i.buildUi({scene:t}),enemies:r.buildUi({scene:t}),explosionParticles:l.buildUi({scene:t})}}}class B{constructor(){t(this,"completeStepSignal",new Phaser.Events.EventEmitter),t(this,"_params"),t(this,"_models"),this._models={enemyModel:_.getModel()}}_onComplete(...e){console.log("complete",this),this.completeStepSignal.emit(y,...e)}forceComplete(){}}class U extends B{}class O{constructor(){t(this,"completeSteps",new Phaser.Events.EventEmitter),t(this,"_sequences"),t(this,"_stepByStepSteps",[]),t(this,"_awaitSteps",[]),t(this,"_permanentsSteps",[]),t(this,"_dynamicSteps",new Set),t(this,"_numPermanentsSteps",0),t(this,"_numConsequentsSteps",0),t(this,"_isForceComplete",!1)}start(e){this._isForceComplete=!1,this._dynamicSteps.clear(),this._sequences=e,this._playNextSequence()}addDynamicStep(e,t){this._dynamicSteps.add(e),console.log("start",e),e.completeStepSignal.once(y,this._onCompleteDynamicStep,this),e.start(t)}_onCompleteDynamicStep(e){this._dynamicSteps.has(e)&&this._dynamicSteps.delete(e)}_playNextSequence(){const e=this._sequences;if(e&&e.length>0){const e=this._sequences.shift();this._setUpSequence(e)}else this._onComplete()}_setUpSequence(e){this._numPermanentsSteps=0,this._stepByStepSteps=e.stepByStep,this._permanentsSteps=e.permanents,this._awaitSteps=e.awaitSteps,this._numConsequentsSteps=e.stepByStep.length,e.permanents.length>0&&this._setUpPermanentsSteps(e.permanents),e.awaitSteps.length>0&&this._setUpAwaitSteps(e.awaitSteps),this._playNextConsequentStep()}_setUpPermanentsSteps(e){for(let t=0;t<e.length;t++){this._numPermanentsSteps++;const s=e[t].step,n=e[t].params;console.log("start",s),s.completeStepSignal.once(y,this._onPermanentStepComplete,this),s.start(n)}}_setUpAwaitSteps(e){for(let t=0;t<e.length;t++){const s=e[t].step,n=e[t].params;console.log("start",s),s.start(n)}}_onPermanentStepComplete(){this._numPermanentsSteps--,0===this._numPermanentsSteps&&this._tryCompleteSequence()}_playNextConsequentStep(){const e=this._stepByStepSteps;if(this._numConsequentsSteps>0){const t=e.length-this._numConsequentsSteps,s=e[t].step,n=e[t].params;console.log("start",s),s.completeStepSignal.once(y,this._onConsequentStepComplete,this),s.start(n)}else this._completeAwaitSteps(),this._tryCompleteSequence()}_completeAwaitSteps(){for(const{step:e}of this._awaitSteps)e.forceComplete();this._awaitSteps=[]}_onConsequentStepComplete(){this._isForceComplete||(this._numConsequentsSteps--,this._playNextConsequentStep())}_tryCompleteSequence(){this._isForceComplete||0===this._numPermanentsSteps&&0===this._numConsequentsSteps&&this._playNextSequence()}_onComplete(){this._sequences=[],this._stepByStepSteps=[],this._permanentsSteps=[],this._awaitSteps=[];for(const e of this._dynamicSteps)e.completeStepSignal.removeAllListeners(),e.forceComplete();this._dynamicSteps.clear(),this.completeSteps.emit(y)}forceComplete(){this._isForceComplete=!0;for(const e of this._stepByStepSteps)e.step.completeStepSignal.removeAllListeners(),e.step.forceComplete();for(const e of this._permanentsSteps)e.step.completeStepSignal.removeAllListeners(),e.step.forceComplete();for(const e of this._awaitSteps)e.step.completeStepSignal.removeAllListeners(),e.step.forceComplete();this._onComplete()}}class D extends B{constructor(){super(),t(this,"_mng",new O),this._mng.completeSteps.on(y,this._onComplete,this)}}class L{constructor(){t(this,"permanents",[]),t(this,"awaitSteps",[]),t(this,"stepByStep",[])}addPermanent(e,t){this.permanents.push({step:e,params:t})}addAwaitPermanentStep(e,t){this.awaitSteps.push({step:e,params:t})}addStepByStep(e,t){this.stepByStep.push({step:e,params:t})}}class A extends B{start(e){this._params=e;const{scene:t,duration:s}=e;t.camera.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,this._onComplete,this),t.camera.fadeOut(s,6,252,255)}}class q extends B{start(e){this._params=e;const{bullet:t,enemyPool:s,bricks:n}=e;for(const o of n)o.visible=!1;for(const o of s.getChildren())s.killAndHide(o),o.visible=!1,o.active=!1;t.setPosition(m,h),this._onComplete()}}class T extends D{constructor(){super(...arguments),t(this,"_hideLvlStep",new A),t(this,"_resetEnemyStep",new q)}start({gameView:e,scene:t}){const s=new L;s.addStepByStep(this._hideLvlStep,{scene:t,duration:500}),s.addStepByStep(this._resetEnemyStep,{scene:t,bullet:e.bullet,enemyPool:e.enemies,bricks:e.bricks}),this._mng.start([s])}}class R extends B{start(e){this._params=e;const{scene:t,duration:s,x:n,y:o}=e;t.camera.stopFollow(),s>0?(t.camera.once("camerazoomcomplete",this._onComplete,this),t.camera.pan(n,o,s,"Sine.easeInOut"),t.zoomTo(1,s,"Sine.easeInOut")):this._onComplete()}_onComplete(){const{scene:e,x:t,y:s}=this._params;e.camera.off("camerazoomcomplete",this._onComplete,this),e.camera.centerOn(t,s),e.setZoom(1),super._onComplete()}}class N extends B{start(e){this._params=e;const{scene:t,bullet:s,constraintComponent:n,slingshotPoint:o}=e;s.setPosition(m,h),s.setStatic(!1),n.createConstraint(s.body,o.slingshotPoint,t),this._onComplete()}}class V extends D{constructor(){super(...arguments),t(this,"_resetBulletStep",new N),t(this,"_moveOnTargetStep",new R)}start({gameView:e,scene:t,constraintComponent:s}){const n=new L;n.addStepByStep(this._resetBulletStep,{scene:t,bullet:e.bullet,constraintComponent:s,slingshotPoint:e.slingshotPoint}),n.addStepByStep(this._moveOnTargetStep,{scene:t,duration:1e3,x:1024,y:768}),this._mng.start([n])}}class z extends B{start(e){this._params=e;const{scene:t,duration:s}=e;t.camera.once(Phaser.Cameras.Scene2D.Events.FADE_IN_COMPLETE,this._onComplete,this),t.camera.fadeIn(s,6,252,255)}}class F extends B{start(e){this._params=e;const{bullet:t,scene:s,enemyPool:n,bricks:o}=e,i=s.cache.json.get("castles");let a=0;for(const l of i){const e=o[a];e.setPosition(p+l.x,c+l.y),e.rotation=l.rotation,e.visible=!0,e.active=!0,a++}const r=s.cache.json.get("enemies");for(let l=0;l<r.length;l++){const e=r[l];n.get().spawn(p+e.x,c+e.y,e.type)}t.setPosition(m,h),t.setStatic(!0),s.camera.stopFollow(),s.camera.centerOn(1024,768),s.setZoom(1),this._onComplete()}}class j extends D{constructor(){super(...arguments),t(this,"_showLvlStep",new z),t(this,"_spawnLvlStep",new F)}start({gameView:e,scene:t}){const s=new L;s.addStepByStep(this._spawnLvlStep,{scene:t,bullet:e.bullet,enemyPool:e.enemies,bricks:e.bricks}),s.addStepByStep(this._showLvlStep,{scene:t,duration:1e3}),this._mng.start([s])}}class I extends B{start(e){this._params=e;const{scene:t,delay:s}=e;t.time.delayedCall(s,this._onComplete,void 0,this)}}class G extends B{start(e){this._params=e;const{scene:t}=e;t.matter.world.on("afterupdate",this._worldUpdate,this)}_worldUpdate(){const{bullet:e,constraintComponent:t}=this._params,s=t.getPosition();e.setPosition(s.x,s.y)}_onComplete(){this._params.scene.matter.world.off("afterupdate",this._worldUpdate,this),this._worldUpdate(),super._onComplete()}forceComplete(){this._onComplete()}}class H extends B{constructor(){super(...arguments),t(this,"targetEnemySignal",new Phaser.Events.EventEmitter)}start(e){this._params=e;const{scene:t,enemyPool:s}=e;for(const n of s.getChildren())n.active&&n.eventSignal.once(C,this._explosion,this);t.matter.world.on("afterupdate",this._worldUpdate,this)}_explosion(e){this.targetEnemySignal.emit(C),this._params.explosionParticles.explode(50,e[0],e[1])}_worldUpdate(){const e=this._params.scene.matter.world.localWorld.bodies,t=this._params.enemyPool;for(const n of t.getChildren())n.active&&n.checkTransform(t);let s=!1;for(const n of e)n.speed>.2&&(s=!0);s||this._onComplete()}_onComplete(){const{enemyPool:e}=this._params;for(const t of e.getChildren())t.active&&t.eventSignal.off(C,this._explosion,this);this._params.scene.matter.world.off("afterupdate",this._worldUpdate,this),super._onComplete()}}class Y extends B{start(e){this._params=e;const{bullet:t,scene:s,duration:n}=e;s.camera.once("camerazoomcomplete",this._onComplete,this),s.camera.pan(t.x,t.y,n,"Sine.easeInOut"),s.zoomTo(1.2,n,"Sine.easeInOut")}_onComplete(){const{bullet:e,scene:t}=this._params;e.setAngularVelocity(-.5),t.camera.off("camerazoomcomplete",this._onComplete,this),t.camera.startFollow(e,!0,.1,.1),super._onComplete()}}class W extends B{constructor(){super(...arguments),t(this,"_trashHold",3),t(this,"_previousDist",150)}start(e){const{bullet:t}=this._params=e,{scene:s,constraintComponent:n}=e;this._previousDist=160,e.scene.matter.world.removeConstraint(n.constraint);const o=t.body.velocity;t.setVelocity(Phaser.Math.Clamp(o.x,-70,70),Phaser.Math.Clamp(o.y,-70,70)),s.matter.world.on("afterupdate",this._worldUpdate,this)}_worldUpdate(){const{bullet:e}=this._params,t=this._params.slingshotPoint,s=this._params.slingshotPoint.slingshotPoint.body.position,n=Phaser.Math.Distance.Between(s.x,s.y,e.x,e.y),o=Math.atan2(e.y-s.y,e.x-s.x);this._params.bullet.body.speed&&this._params.bullet.body.speed>0&&(n<this._trashHold||n>this._previousDist)?(t.rotateSlingshotPoint(0),t.rotateRope(0,1),this._onComplete()):(t.rotateSlingshotPoint(n),t.rotateRope(o,n),this._previousDist=n)}_onComplete(){this._params.scene.matter.world.off("afterupdate",this._worldUpdate,this),super._onComplete()}}class X extends D{constructor(){super(...arguments),t(this,"_endStrikeStep",new H),t(this,"_startStrikeStep",new W),t(this,"_awaitStep",new I),t(this,"_preparationStrikeStep",new Y),t(this,"_awaitStrikeStep",new G),t(this,"_isWin",!1)}start({gameView:e,scene:t,constraintComponent:s}){this._isWin=!1;const n=new L;n.addAwaitPermanentStep(this._awaitStrikeStep,{scene:t,bullet:e.bullet,constraintComponent:s}),n.addStepByStep(this._preparationStrikeStep,{scene:t,bullet:e.bullet,duration:1e3});const o=new L;o.addStepByStep(this._startStrikeStep,{scene:t,bullet:e.bullet,constraintComponent:s,slingshotPoint:e.slingshotPoint});const i=this._endStrikeStep;i.targetEnemySignal.on(C,this._onTarget,this),o.addStepByStep(i,{scene:t,enemyPool:e.enemies,explosionParticles:e.explosionParticles}),o.addStepByStep(this._awaitStep,{scene:t,delay:2e3}),this._mng.start([n,o])}_onTarget(){this._models.enemyModel.lvlEnemies--,this._models.enemyModel.lvlEnemies<=0&&(this._isWin=!0)}_onComplete(){this._endStrikeStep.targetEnemySignal.off(C,this._onTarget,this),super._onComplete(this._isWin)}}class Z extends B{constructor(){super(...arguments),t(this,"_pointerComponent")}start(e){this._params=e;const{scene:t,pointerComponent:s}=e;this._pointerComponent=s,t.input.on("pointerdown",this._startDrag,this)}_startDrag(e){const t=e.positionToCamera(this._params.scene.cameras.main),s=this._params.bullet;Phaser.Math.Distance.Between(t.x,t.y,s.x,s.y)<100&&(this._pointerComponent.pointer=t,this._pointerComponent.startDrag(),this._onComplete())}_onComplete(){this._params.scene.input.off("pointerdown",this._startDrag,this),super._onComplete()}}class K extends B{constructor(){super(...arguments),t(this,"_pointerComponent")}start(e){this._params=e;const{scene:t,pointerComponent:s}=e;this._pointerComponent=s,t.input.on("pointermove",this._onPointerMove,this),t.matter.world.on("afterupdate",this._onPhysicUpdate,this)}_onComplete(){const e=this._params.scene;e.input.off("pointermove",this._onPointerMove,this),e.matter.world.off("afterupdate",this._onPhysicUpdate,this),super._onComplete()}_onPhysicUpdate(){this._pointerComponent.isDragging&&this._pointerComponent.pointer&&this._onDrag(this._pointerComponent.pointer)}_onPointerMove(e){this._pointerComponent.isDragging&&(this._pointerComponent.pointer=e.positionToCamera(this._params.scene.cameras.main))}_onDrag(e){const t=e,s=this._params.slingshotPoint,n=this._params.slingshotPoint.slingshotPoint.body.position,{bullet:o,constraintComponent:i}=this._params,a=Phaser.Math.Distance.Between(n.x,n.y,t.x,t.y),r=Math.atan2(t.y-n.y,t.x-n.x);if(a<l)o.setPosition(t.x,t.y),i.setPosition(t.x,t.y),s.rotateSlingshotPoint(a),s.rotateRope(r,a);else{const e=Math.sin(r)*l,t=Math.cos(r)*l;o.setPosition(n.x+t,n.y+e),i.setPosition(n.x+t,n.y+e),s.rotateSlingshotPoint(l),s.rotateRope(r,l)}}forceComplete(){this._onComplete()}}class J extends B{constructor(){super(...arguments),t(this,"_pointerComponent")}start(e){this._params=e;const{scene:t,pointerComponent:s}=e;this._pointerComponent=s,t.input.on("pointerup",this._release,this)}_release(){this._pointerComponent.isDragging&&(this._pointerComponent.endDrag(),this._pointerComponent.pointer=void 0,this._onComplete())}_onComplete(){this._params.scene.input.off("pointerup",this._release,this),super._onComplete()}}class Q extends D{constructor(){super(...arguments),t(this,"_awaitUserActionStep",new Z),t(this,"_endDragStep",new J),t(this,"_dragActionStep",new K),t(this,"_resetBulletStep",new N)}start({gameView:e,pointerComponent:t,constraintComponent:s,isFirst:n,scene:o}){const i=[];if(n){const t=new L;i.push(t),t.addStepByStep(this._resetBulletStep,{scene:o,bullet:e.bullet,constraintComponent:s,slingshotPoint:e.slingshotPoint})}const a=new L;i.push(a),a.addStepByStep(this._awaitUserActionStep,{scene:o,bullet:e.bullet,pointerComponent:t});const r=new L;i.push(r),r.addAwaitPermanentStep(this._dragActionStep,{scene:o,bullet:e.bullet,slingshotPoint:e.slingshotPoint,pointerComponent:t,constraintComponent:s}),r.addStepByStep(this._endDragStep,{scene:o,pointerComponent:t}),this._mng.start(i)}}class $ extends U{constructor(){super(...arguments),t(this,"_userActionController",new Q),t(this,"_strikeController",new X),t(this,"_showLvlController",new j),t(this,"_resetRoundController",new V),t(this,"_hideLvlController",new T),t(this,"_firstRound",!0)}start(e){this._params=e,this._playShowLvl()}_playShowLvl(){this._models.enemyModel.resetLvlEnemies();const{gameView:e,scene:t}=this._params;this._firstRound=!0;const s=this._showLvlController;s.completeStepSignal.once(y,this._playNextRound,this),s.start({gameView:e,scene:t})}_playStrike(){this._firstRound=!1;const e=this._strikeController;e.completeStepSignal.once(y,this._playResult,this);const{scene:t,gameView:s,constraintComponent:n}=this._params;e.start({scene:t,gameView:s,constraintComponent:n})}_playResult(e){e?this._hideLvl():this._resetRound()}_hideLvl(){console.log("WIN");const{gameView:e,scene:t}=this._params,s=this._hideLvlController;s.completeStepSignal.once(y,this._playShowLvl,this),s.start({gameView:e,scene:t})}_resetRound(){const{gameView:e,scene:t,constraintComponent:s}=this._params,n=this._resetRoundController;n.completeStepSignal.once(y,this._playNextRound,this),n.start({gameView:e,constraintComponent:s,scene:t})}_playNextRound(){const{gameView:e,pointerComponent:t,constraintComponent:s,scene:n}=this._params,o=this._userActionController;o.completeStepSignal.once(y,this._playStrike,this),o.start({gameView:e,pointerComponent:t,constraintComponent:s,scene:n,isFirst:this._firstRound})}}class ee{constructor(){t(this,"pointer"),t(this,"_isDragging",!1)}startDrag(){this._isDragging=!0}endDrag(){this._isDragging=!1}get isDragging(){return this._isDragging}}class te{constructor(){t(this,"_constraint"),t(this,"_pos")}createConstraint(e,t,s){return this._constraint=s.matter.add.constraint(e,t,0,.02),this._constraint}setPosition(e,t){this._pos=new Phaser.Math.Vector2(e,t)}getPosition(){return this._pos}get constraint(){return this._constraint}pauseUpdate(){}}class se extends n.Scene{constructor(){super("Game"),t(this,"camera"),t(this,"_scale",1)}create(){this.camera=this.cameras.main,this.scale.on("resize",this.resize,this),this.resize({width:window.innerWidth,height:window.innerHeight}),this.add.rectangle(0,0,a,r,16777215).setOrigin(0),this._createGame()}_createGame(){this.matter.world.setBounds(0,0,a,r);const e=(new M).buildUi({scene:this}),t=new te,s=new ee;(new $).start({gameView:e,pointerComponent:s,constraintComponent:t,scene:this})}resize(e){const{width:t,height:s}=e,n=t,o=s,i=a,l=r,c=this._scale=Math.min(n/i,o/l);this.cameras.main.setZoom(c),this.cameras.main.centerOn(1024,768)}zoomTo(e,t,s){this.camera.zoomTo(this._scale*e,t,s)}setZoom(e){this.cameras.main.setZoom(this._scale*e)}}class ne extends n.Scene{constructor(){super("MainMenu"),t(this,"background"),t(this,"logo"),t(this,"title")}create(){this.background=this.add.image(512,384,"background"),this.logo=this.add.image(512,300,"logo"),this.title=this.add.text(512,460,"Main Menu",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("Game")}))}}class oe extends n.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const e=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(t=>{e.width=4+460*t}))}preload(){this.load.json("castles","data/castles.json"),this.load.json("enemies","data/enemies.json"),this.load.setPath("assets"),this.load.image("gameBg","game/sky.png"),this.load.image("logo","logo.png"),this.load.image("bgTile","game/GrassCliffMid.png"),this.load.image("saw","game/Saw.png"),this.load.image("brick_tile","game/brick_tile.png"),this.load.image("slingshot_bottom","game/slingshotPoint_b.png"),this.load.image("slingshot_top","game/slingshotPoint_t.png"),this.load.image("slingshotPoint_point","game/slingshotPoint_point.png"),this.load.image("rope","game/rope.png"),this.load.image("chest","game/chest.png"),this.load.image("enemy","game/enemy.png"),this.load.image("mace","game/Mace.png"),this.load.image("spark","game/spark.png")}create(){this.scene.start("MainMenu")}}const ie={type:n.AUTO,width:a,height:r,parent:"game-container",backgroundColor:"#028af8",physics:{default:"matter",matter:{gravity:{y:1,x:0},debug:!0}},scene:[o,oe,ne,se,i],scale:{mode:Phaser.Scale.NONE,autoCenter:Phaser.Scale.NO_CENTER}};document.addEventListener("DOMContentLoaded",(()=>{(()=>{const e=new n.Game({...ie,parent:"game-container"});e.scale.resize(window.innerWidth,window.innerHeight),window.addEventListener("resize",(()=>{e.scale.resize(window.innerWidth,window.innerHeight)}))})()}));
