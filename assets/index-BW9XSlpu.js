var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{r as s}from"./phaser-UvlxNa5i.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var n=s();class i extends n.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class o extends n.Scene{constructor(){super("GameOver"),t(this,"camera"),t(this,"background"),t(this,"gameover_text")}create(){this.camera=this.cameras.main,this.camera.setBackgroundColor(16711680),this.background=this.add.image(512,384,"background"),this.background.setAlpha(.5),this.gameover_text=this.add.text(512,384,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.gameover_text.setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}}const a=2048,r=1536,l=150,h=128,c=1382.4,p=1254.4,m=1638.4,d=1044.4,_=375,g=class e{constructor(){t(this,"_lvl",0),t(this,"maxEnemies",3),t(this,"lvlEnemies",1)}static getModel(){return e.instance||(e.instance=new e),e.instance}resetLvlEnemies(e){this.lvlEnemies=e}increaseLvl(){this._lvl++,this._lvl=this._lvl%12}get lvl(){return this._lvl}};t(g,"instance");let u=g;class S{constructor(){t(this,"_models"),this._models={enemyModel:u.getModel()}}}const w="COMPLETE",y="EXPLOSION";class C extends Phaser.Physics.Matter.Image{constructor(e,s,n,i,o){super(e.matter.world,s,n,i),t(this,"eventSignal",new Phaser.Events.EventEmitter),t(this,"_enemyPool"),t(this,"_scene"),t(this,"_spawnX",0),t(this,"_spawnY",0),this._scene=e,e.add.existing(this),this._enemyPool=o,e.matter.world.remove(this),e.matter.world.remove(this.body),this.body.gameObject=this}spawn(e,t,s){s&&this.setTexture(s),this.setPosition(e,t),this.angle=0,this._spawnX=e,this._spawnY=t,this.setSensor(!1),this.setIgnoreGravity(!1),this.setStatic(!1),this.visible=!0,this.active=!0,this._scene.matter.world.add(this.body)}checkTransform(){Phaser.Math.Distance.Between(this._spawnX,this._spawnY,this.x,this.y)>62&&this._destroy()}_destroy(){this.eventSignal.emit(y,[this.x,this.y]),this.hideObject()}hit(){this.active&&this._destroy()}hideObject(){const e=this._scene;e.matter.world.remove(this),e.matter.world.remove(this.body),this.setSensor(!0),this.setIgnoreGravity(!0),this.setStatic(!0),this.setAngle(0),this.setVelocity(0),this.setAngularSpeed(0),this.setAngularVelocity(0),this.x=0,this.y=0,this._enemyPool.killAndHide(this),this.visible=!1,this.active=!1}}class b extends Phaser.Physics.Matter.Image{constructor(e,s,n,i){super(e.matter.world,s,n,i),t(this,"eventSignal",new Phaser.Events.EventEmitter),e.add.existing(this),e.matter.world.once("afterupdate",(()=>{this.setOnCollide(this._hit.bind(this))}))}_hit(e){const{bodyA:t,bodyB:s}=e,n=s.gameObject,i=t.gameObject;n instanceof C?n.hit():i instanceof C&&i.hit()}}class f extends S{}class x extends f{buildUi({scene:e}){const t=new b(e,_,d,"saw").setCircle(60).setBounce(.4).setMass(20);return t.setFrictionAir(.02),t.setScale(.5),t}}class P extends Phaser.Physics.Matter.Image{constructor(e,s,n,i,o){super(e.matter.world,s,n,i),t(this,"eventSignal",new Phaser.Events.EventEmitter),t(this,"_brickPool"),t(this,"_scene"),t(this,"_spawnX",0),t(this,"_spawnY",0),this._scene=e,e.add.existing(this),this._brickPool=o,this.setBody({type:"rectangle",width:96,height:32},{isSensor:!0}),this.setBounce(0).setFriction(.8).setFrictionStatic(1),this.visible=!1,this.active=!1,this.setSensor(!0),this.setIgnoreGravity(!0),this.rotation=0,e.matter.world.remove(this),e.matter.world.remove(this.body),this.body.gameObject=this}spawn(e,t,s,n){n&&this.setTexture(n),this.rotation=s,this.setPosition(e,t),this._spawnX=e,this._spawnY=t,this.visible=!0,this.active=!0,this.setSensor(!1),this.setIgnoreGravity(!1),this.setStatic(!1),this._scene.matter.world.add(this.body)}checkTransform(){Phaser.Math.Distance.Between(this._spawnX,this._spawnY,this.x,this.y)>128&&this._destroy()}_destroy(){this.eventSignal.emit(y,[this.x,this.y]),this.hideObject()}hit(){}hideObject(){const e=this._scene;e.matter.world.remove(this),e.matter.world.remove(this.body),this.setSensor(!0),this.setIgnoreGravity(!0),this.setStatic(!0),this.setAngle(0),this.setVelocity(0),this.setAngularSpeed(0),this.setAngularVelocity(0),this.x=0,this.y=0,this._brickPool.killAndHide(this),this.visible=!1,this.active=!1}}class v extends f{buildUi({scene:e}){const t=e.add.group({classType:P,maxSize:8});for(let s=0;s<8;s++){const s=new P(e,0,0,"brick_tile",t);t.add(s),t.killAndHide(s)}return t}}class k extends f{buildUi({scene:e}){const t=this._models.enemyModel.maxEnemies,s=e.add.group({classType:C,maxSize:t});for(let n=0;n<t;n++){const t=new C(e,0,0,"enemy",s);t.setScale(-1,1),t.setPosition(1686.4,1222.4),s.add(t),s.killAndHide(t)}return s}}class M extends f{buildUi({scene:e}){return e.add.particles(0,0,"spark",{x:0,y:0,speed:{min:-300,max:300},angle:{min:0,max:360},lifespan:1100,scale:{start:.5,end:0},alpha:{start:1,end:.75},gravityY:400,blendMode:"ADD",emitting:!1,tint:[16711680],quantity:50})}}class O extends f{buildUi({scene:e}){return e.add.particles(0,0,"spark",{x:0,y:0,speed:{min:-300,max:300},angle:{min:0,max:360},lifespan:1100,scale:{start:.5,end:0},alpha:{start:1,end:.75},gravityY:400,blendMode:"ADD",emitting:!1,tint:[16711680,65280,255],quantity:50})}}class E extends f{buildUi({scene:e}){const t=e.add.container(),s=e.add.image(1024,768,"gameBg");s.setScale(100,8),s.setOrigin(.5,.7),t.add(s);for(let o=0;o<10;o++){const s=e.add.image(3072*Math.random()-512,r*Math.random(),o%2==0?"cloud1":"cloud2");t.add(s)}const n=e.add.tileSprite(1024,268,4096,511,"hills2");n.texture.setFilter(Phaser.Textures.FilterMode.NEAREST),n.setOrigin(.5,1),n.setScale(-2),t.add(n);const i=e.add.tileSprite(1024,268,4096,511,"hills1");return i.setOrigin(.5,1),i.setScale(-2),i.texture.setFilter(Phaser.Textures.FilterMode.NEAREST),t.add(i),t}}class B extends f{buildUi({scene:e}){const t=[];for(let s=0;s<3;s++){const n=e.add.tileSprite(1766.4,c-(h*(s+1)+64),128*(4-s),h,"bgTile");n.setOrigin(.5),e.matter.add.gameObject(n,{isStatic:!0,label:"mountains"}),n.visible=!1,n.active=!1,e.matter.world.remove(n),e.matter.world.remove(n.body),t.push(n)}return t}}class U extends f{buildUi({scene:e}){const t=e.add.tileSprite(1024,1318.4,8192,h,"bgTile");return t.setOrigin(.5),e.matter.add.gameObject(t,{isStatic:!0,label:"ground"}),t}}class A extends Phaser.GameObjects.Container{constructor(){super(...arguments),t(this,"_slingshotPoint"),t(this,"_rope"),t(this,"_baseRopeHeight")}build(e){const{scene:t,topPart:s,bottomPart:n,slingshotPointConfig:i,ropeConfig:o}=e,a=new Phaser.GameObjects.Image(t,s.x,s.y,s.texture);a.setOrigin(s.anchor.x,s.anchor.y),a.setScale(s.scaleX||1,s.scaleY||1),this.add(a);const r=new Phaser.GameObjects.Image(t,n.x,a.height,n.texture);r.setOrigin(n.anchor.x,n.anchor.y),r.setScale(n.scaleX||1,n.scaleY||1),this.add(r);const l=this._rope=new Phaser.GameObjects.Image(t,o.x,o.y,o.texture);l.setOrigin(o.anchor.x,o.anchor.y),this._baseRopeHeight=l.height||1,l.setScale(o.scaleX||1,o.scaleY||1),this.add(l),(this._slingshotPoint=t.matter.add.image(i.x,i.y,i.texture,"",{isStatic:!0,isSensor:!0,render:{visible:!0}})).setScale(i.scaleX||1,i.scaleY||1)}get slingshotPoint(){return this._slingshotPoint}rotateSlingshotPoint(e){this._slingshotPoint.angle=3*e}rotateRope(e,t){const s=this._rope;s.angle=Phaser.Math.RadToDeg(e)-90;const n=t/this._baseRopeHeight;s.setScale(1,n)}}class D extends f{buildUi({scene:e}){const t=new A(e,_,d);return e.add.existing(t),t.build({scene:e,topPart:{texture:"slingshot_top",x:0,y:0,anchor:{x:.5,y:0}},bottomPart:{texture:"slingshot_bottom",x:0,y:0,anchor:{x:.5,y:0},scaleY:3.7},ropeConfig:{texture:"rope",x:0,y:0,anchor:{x:.5,y:0},scaleY:0},slingshotPointConfig:{texture:"slingshotPoint_point",x:_,y:d,anchor:{x:.5,y:.5},scaleX:2,scaleY:2}}),t}}class L extends S{buildUi(e){const{scene:t}=e,s=new U,n=new x,i=new D,o=new v,a=new E,r=new k,l=new O,h=new M,c=new B;return{bg:a.buildUi({scene:t}),ground:s.buildUi({scene:t}),mountains:c.buildUi({scene:t}),bullet:n.buildUi({scene:t}),slingshotPoint:i.buildUi({scene:t}),bricks:o.buildUi({scene:t}),enemies:r.buildUi({scene:t}),explosionParticles:l.buildUi({scene:t}),explosionCastleParticles:h.buildUi({scene:t})}}}class T{constructor(){t(this,"completeStepSignal",new Phaser.Events.EventEmitter),t(this,"_params"),t(this,"_models"),this._models={enemyModel:u.getModel()}}_onComplete(...e){console.log("complete",this),this.completeStepSignal.emit(w,...e)}forceComplete(){}}class q extends T{}class R{constructor(){t(this,"completeSteps",new Phaser.Events.EventEmitter),t(this,"_sequences"),t(this,"_stepByStepSteps",[]),t(this,"_awaitSteps",[]),t(this,"_permanentsSteps",[]),t(this,"_dynamicSteps",new Set),t(this,"_numPermanentsSteps",0),t(this,"_numConsequentsSteps",0),t(this,"_isForceComplete",!1)}start(e){this._isForceComplete=!1,this._dynamicSteps.clear(),this._sequences=e,this._playNextSequence()}addDynamicStep(e,t){this._dynamicSteps.add(e),console.log("start",e),e.completeStepSignal.once(w,this._onCompleteDynamicStep,this),e.start(t)}_onCompleteDynamicStep(e){this._dynamicSteps.has(e)&&this._dynamicSteps.delete(e)}_playNextSequence(){const e=this._sequences;if(e&&e.length>0){const e=this._sequences.shift();this._setUpSequence(e)}else this._onComplete()}_setUpSequence(e){this._numPermanentsSteps=0,this._stepByStepSteps=e.stepByStep,this._permanentsSteps=e.permanents,this._awaitSteps=e.awaitSteps,this._numConsequentsSteps=e.stepByStep.length,e.permanents.length>0&&this._setUpPermanentsSteps(e.permanents),e.awaitSteps.length>0&&this._setUpAwaitSteps(e.awaitSteps),this._playNextConsequentStep()}_setUpPermanentsSteps(e){for(let t=0;t<e.length;t++){this._numPermanentsSteps++;const s=e[t].step,n=e[t].params;console.log("start",s),s.completeStepSignal.once(w,this._onPermanentStepComplete,this),s.start(n)}}_setUpAwaitSteps(e){for(let t=0;t<e.length;t++){const s=e[t].step,n=e[t].params;console.log("start",s),s.start(n)}}_onPermanentStepComplete(){this._numPermanentsSteps--,0===this._numPermanentsSteps&&this._tryCompleteSequence()}_playNextConsequentStep(){const e=this._stepByStepSteps;if(this._numConsequentsSteps>0){const t=e.length-this._numConsequentsSteps,s=e[t].step,n=e[t].params;console.log("start",s),s.completeStepSignal.once(w,this._onConsequentStepComplete,this),s.start(n)}else this._completeAwaitSteps(),this._tryCompleteSequence()}_completeAwaitSteps(){for(const{step:e}of this._awaitSteps)e.forceComplete();this._awaitSteps=[]}_onConsequentStepComplete(){this._isForceComplete||(this._numConsequentsSteps--,this._playNextConsequentStep())}_tryCompleteSequence(){this._isForceComplete||0===this._numPermanentsSteps&&0===this._numConsequentsSteps&&this._playNextSequence()}_onComplete(){this._sequences=[],this._stepByStepSteps=[],this._permanentsSteps=[],this._awaitSteps=[];for(const e of this._dynamicSteps)e.completeStepSignal.removeAllListeners(),e.forceComplete();this._dynamicSteps.clear(),this.completeSteps.emit(w)}forceComplete(){this._isForceComplete=!0;for(const e of this._stepByStepSteps)e.step.completeStepSignal.removeAllListeners(),e.step.forceComplete();for(const e of this._permanentsSteps)e.step.completeStepSignal.removeAllListeners(),e.step.forceComplete();for(const e of this._awaitSteps)e.step.completeStepSignal.removeAllListeners(),e.step.forceComplete();this._onComplete()}}class V extends T{constructor(){super(),t(this,"_mng",new R),this._mng.completeSteps.on(w,this._onComplete,this)}}class F{constructor(){t(this,"permanents",[]),t(this,"awaitSteps",[]),t(this,"stepByStep",[])}addPermanent(e,t){this.permanents.push({step:e,params:t})}addAwaitPermanentStep(e,t){this.awaitSteps.push({step:e,params:t})}addStepByStep(e,t){this.stepByStep.push({step:e,params:t})}}class I extends T{start(e){this._params=e;const{scene:t,duration:s}=e;t.camera.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,this._onComplete,this),t.camera.fadeOut(s,6,252,255)}}class N extends T{start(e){this._params=e;const{bullet:t,enemyPool:s,bricks:n,mountains:i,scene:o}=e;o.matter.world.pause();for(const a of n.getChildren())a.hideObject();for(const a of s.getChildren())s.killAndHide(a),a.visible=!1,a.active=!1;for(const a of i)a.visible=!1,a.active=!1,o.matter.world.remove(a.body);t.setPosition(_,d),this._onComplete()}}class j extends V{constructor(){super(...arguments),t(this,"_hideLvlStep",new I),t(this,"_resetLvlStep",new N)}start({gameView:e,scene:t}){const s=new F;s.addStepByStep(this._hideLvlStep,{scene:t,duration:500}),s.addStepByStep(this._resetLvlStep,{scene:t,bullet:e.bullet,enemyPool:e.enemies,bricks:e.bricks,mountains:e.mountains}),this._mng.start([s])}}class z extends T{start(e){this._params=e;const{scene:t,duration:s,x:n,y:i}=e;t.camera.stopFollow(),s>0?(t.camera.once("camerazoomcomplete",this._onComplete,this),t.camera.pan(n,i,s,"Sine.easeInOut"),t.zoomTo(1,s,"Sine.easeInOut")):this._onComplete()}_onComplete(){const{scene:e,x:t,y:s}=this._params;e.camera.off("camerazoomcomplete",this._onComplete,this),e.camera.centerOn(t,s),e.setZoom(1),super._onComplete()}}class G extends T{start(e){this._params=e;const{scene:t,bullet:s,constraintComponent:n,slingshotPoint:i}=e;s.setPosition(_,d),s.setStatic(!1),n.createConstraint(s.body,i.slingshotPoint,t),this._onComplete()}}class H extends V{constructor(){super(...arguments),t(this,"_resetBulletStep",new G),t(this,"_moveOnTargetStep",new z)}start({gameView:e,scene:t,constraintComponent:s}){const n=new F;n.addStepByStep(this._resetBulletStep,{scene:t,bullet:e.bullet,constraintComponent:s,slingshotPoint:e.slingshotPoint}),n.addStepByStep(this._moveOnTargetStep,{scene:t,duration:1e3,x:1024,y:768}),this._mng.start([n])}}class Y extends T{start(e){this._params=e;const{scene:t,duration:s}=e;t.camera.once(Phaser.Cameras.Scene2D.Events.FADE_IN_COMPLETE,this._onComplete,this),t.camera.fadeIn(s,6,252,255)}}class X extends T{start(e){this._params=e;const{bullet:t,scene:s,enemyPool:n,bricks:i,lvl:o,mountains:a}=e;for(let p=0;p<o.mountains;p++){const e=a[3-o.mountains+p];e.setPosition(1734.4,c-(h*(p+1)+64)),e.active=!0,e.visible=!0,s.matter.world.add(e.body)}const r=o.castle;for(const c of r)i.get().spawn(m+c.x,p-o.mountains*h+c.y,c.rotation);const l=o.enemies;for(let c=0;c<l.length;c++){const e=l[c];n.get().spawn(m+e.x,p-o.mountains*h+e.y,e.type)}t.setPosition(_,d),t.setStatic(!0),s.time.delayedCall(50,(()=>s.matter.world.resume())),s.camera.stopFollow(),s.camera.centerOn(1024,768),s.setZoom(1),this._onComplete()}}class W extends V{constructor(){super(...arguments),t(this,"_showLvlStep",new Y),t(this,"_spawnLvlStep",new X)}start({gameView:e,lvl:t,scene:s}){const n=new F;n.addStepByStep(this._spawnLvlStep,{scene:s,bullet:e.bullet,enemyPool:e.enemies,bricks:e.bricks,lvl:t,mountains:e.mountains}),n.addStepByStep(this._showLvlStep,{scene:s,duration:1e3}),this._mng.start([n])}}class Z extends T{start(e){this._params=e;const{scene:t,delay:s}=e;t.time.delayedCall(s,this._onComplete,void 0,this)}}class K extends T{start(e){this._params=e;const{scene:t}=e;t.matter.world.on("afterupdate",this._worldUpdate,this)}_worldUpdate(){const{bullet:e,constraintComponent:t}=this._params,s=t.getPosition();e.setPosition(s.x,s.y)}_onComplete(){this._params.scene.matter.world.off("afterupdate",this._worldUpdate,this),this._worldUpdate(),super._onComplete()}forceComplete(){this._onComplete()}}class J extends T{constructor(){super(...arguments),t(this,"targetEnemySignal",new Phaser.Events.EventEmitter)}start(e){this._params=e;const{scene:t,enemyPool:s,castlePool:n}=e;for(const i of s.getChildren())i.active&&i.eventSignal.once(y,this._explosion,this);for(const i of n.getChildren())i.active&&i.eventSignal.once(y,this._explosionBrick,this);t.matter.world.on("afterupdate",this._worldUpdate,this)}_explosion(e){this.targetEnemySignal.emit(y),this._params.explosionParticles.explode(50,e[0],e[1])}_explosionBrick(e){this._params.explosionCastleParticles.explode(50,e[0],e[1])}_worldUpdate(){const e=this._params.scene.matter.world.localWorld.bodies,{enemyPool:t,castlePool:s}=this._params;for(const i of t.getChildren())i.active&&i.checkTransform();for(const i of s.getChildren())i.active&&i.checkTransform();let n=!1;for(const i of e)i.speed>.2&&(n=!0);n||this._onComplete()}_onComplete(){const{enemyPool:e,castlePool:t}=this._params;for(const s of e.getChildren())s.eventSignal.off(y,this._explosion,this);for(const s of t.getChildren())s.eventSignal.off(y,this._explosion,this);this._params.scene.matter.world.off("afterupdate",this._worldUpdate,this),super._onComplete()}}class Q extends T{start(e){this._params=e;const{bullet:t,scene:s,duration:n}=e;s.camera.once("camerazoomcomplete",this._onComplete,this),s.camera.pan(t.x,t.y,n,"Sine.easeInOut"),s.zoomTo(1.2,n,"Sine.easeInOut")}_onComplete(){const{bullet:e,scene:t}=this._params;e.setAngularVelocity(-.5),t.camera.off("camerazoomcomplete",this._onComplete,this),t.camera.startFollow(e,!0,.1,.1),super._onComplete()}}class $ extends T{constructor(){super(...arguments),t(this,"_trashHold",3),t(this,"_previousDist",150)}start(e){const{bullet:t}=this._params=e,{scene:s,constraintComponent:n}=e;this._previousDist=160,e.scene.matter.world.removeConstraint(n.constraint);const i=t.body.velocity;t.setVelocity(Phaser.Math.Clamp(i.x,-70,70),Phaser.Math.Clamp(i.y,-70,70)),s.matter.world.on("afterupdate",this._worldUpdate,this)}_worldUpdate(){const{bullet:e}=this._params,t=this._params.slingshotPoint,s=this._params.slingshotPoint.slingshotPoint.body.position,n=Phaser.Math.Distance.Between(s.x,s.y,e.x,e.y),i=Math.atan2(e.y-s.y,e.x-s.x);this._params.bullet.body.speed&&this._params.bullet.body.speed>0&&(n<this._trashHold||n>this._previousDist)?(t.rotateSlingshotPoint(0),t.rotateRope(0,1),this._onComplete()):(t.rotateSlingshotPoint(n),t.rotateRope(i,n),this._previousDist=n)}_onComplete(){this._params.scene.matter.world.off("afterupdate",this._worldUpdate,this),super._onComplete()}}class ee extends V{constructor(){super(...arguments),t(this,"_endStrikeStep",new J),t(this,"_startStrikeStep",new $),t(this,"_awaitStep",new Z),t(this,"_preparationStrikeStep",new Q),t(this,"_awaitStrikeStep",new K),t(this,"_isWin",!1)}start({gameView:e,scene:t,constraintComponent:s}){this._isWin=!1;const n=new F;n.addAwaitPermanentStep(this._awaitStrikeStep,{scene:t,bullet:e.bullet,constraintComponent:s}),n.addStepByStep(this._preparationStrikeStep,{scene:t,bullet:e.bullet,duration:1e3});const i=new F;i.addStepByStep(this._startStrikeStep,{scene:t,bullet:e.bullet,constraintComponent:s,slingshotPoint:e.slingshotPoint});const o=this._endStrikeStep;o.targetEnemySignal.on(y,this._onTarget,this),i.addStepByStep(o,{scene:t,enemyPool:e.enemies,explosionParticles:e.explosionParticles,explosionCastleParticles:e.explosionCastleParticles,castlePool:e.bricks}),i.addStepByStep(this._awaitStep,{scene:t,delay:2e3}),this._mng.start([n,i])}_onTarget(){this._models.enemyModel.lvlEnemies--,this._models.enemyModel.lvlEnemies<=0&&(this._isWin=!0)}_onComplete(){this._endStrikeStep.targetEnemySignal.off(y,this._onTarget,this),super._onComplete(this._isWin)}}class te extends T{constructor(){super(...arguments),t(this,"_pointerComponent")}start(e){this._params=e;const{scene:t,pointerComponent:s}=e;this._pointerComponent=s,t.input.on("pointerdown",this._startDrag,this)}_startDrag(e){const t=e.positionToCamera(this._params.scene.cameras.main),s=this._params.bullet;Phaser.Math.Distance.Between(t.x,t.y,s.x,s.y)<100&&(this._pointerComponent.pointer=t,this._pointerComponent.startDrag(),this._onComplete())}_onComplete(){this._params.scene.input.off("pointerdown",this._startDrag,this),super._onComplete()}}class se extends T{constructor(){super(...arguments),t(this,"_pointerComponent")}start(e){this._params=e;const{scene:t,pointerComponent:s}=e;this._pointerComponent=s,t.input.on("pointermove",this._onPointerMove,this),t.matter.world.on("afterupdate",this._onPhysicUpdate,this)}_onComplete(){const e=this._params.scene;e.input.off("pointermove",this._onPointerMove,this),e.matter.world.off("afterupdate",this._onPhysicUpdate,this),super._onComplete()}_onPhysicUpdate(){this._pointerComponent.isDragging&&this._pointerComponent.pointer&&this._onDrag(this._pointerComponent.pointer)}_onPointerMove(e){this._pointerComponent.isDragging&&(this._pointerComponent.pointer=e.positionToCamera(this._params.scene.cameras.main))}_onDrag(e){const t=e,s=this._params.slingshotPoint,n=this._params.slingshotPoint.slingshotPoint.body.position,{bullet:i,constraintComponent:o}=this._params,a=Phaser.Math.Distance.Between(n.x,n.y,t.x,t.y),r=Math.atan2(t.y-n.y,t.x-n.x);if(a<l)i.setPosition(t.x,t.y),o.setPosition(t.x,t.y),s.rotateSlingshotPoint(a),s.rotateRope(r,a);else{const e=Math.sin(r)*l,t=Math.cos(r)*l;i.setPosition(n.x+t,n.y+e),o.setPosition(n.x+t,n.y+e),s.rotateSlingshotPoint(l),s.rotateRope(r,l)}}forceComplete(){this._onComplete()}}class ne extends T{constructor(){super(...arguments),t(this,"_pointerComponent")}start(e){this._params=e;const{scene:t,pointerComponent:s}=e;this._pointerComponent=s,t.input.on("pointerup",this._release,this)}_release(){this._pointerComponent.isDragging&&(this._pointerComponent.endDrag(),this._pointerComponent.pointer=void 0,this._onComplete())}_onComplete(){this._params.scene.input.off("pointerup",this._release,this),super._onComplete()}}class ie extends V{constructor(){super(...arguments),t(this,"_awaitUserActionStep",new te),t(this,"_endDragStep",new ne),t(this,"_dragActionStep",new se),t(this,"_resetBulletStep",new G)}start({gameView:e,pointerComponent:t,constraintComponent:s,isFirst:n,scene:i}){const o=[];if(n){const t=new F;o.push(t),t.addStepByStep(this._resetBulletStep,{scene:i,bullet:e.bullet,constraintComponent:s,slingshotPoint:e.slingshotPoint})}const a=new F;o.push(a),a.addStepByStep(this._awaitUserActionStep,{scene:i,bullet:e.bullet,pointerComponent:t});const r=new F;o.push(r),r.addAwaitPermanentStep(this._dragActionStep,{scene:i,bullet:e.bullet,slingshotPoint:e.slingshotPoint,pointerComponent:t,constraintComponent:s}),r.addStepByStep(this._endDragStep,{scene:i,pointerComponent:t}),this._mng.start(o)}}class oe extends q{constructor(){super(...arguments),t(this,"_userActionController",new ie),t(this,"_strikeController",new ee),t(this,"_showLvlController",new W),t(this,"_resetRoundController",new H),t(this,"_hideLvlController",new j),t(this,"_firstRound",!0)}start(e){this._params=e,this._playShowLvl()}_playShowLvl(){const e=this._params.scene.cache.json.get("lvls")[this._models.enemyModel.lvl];this._models.enemyModel.resetLvlEnemies(e.targets);const{gameView:t,scene:s}=this._params;this._firstRound=!0;const n=this._showLvlController;n.completeStepSignal.once(w,this._playNextRound,this),n.start({gameView:t,scene:s,lvl:e})}_playStrike(){this._firstRound=!1;const e=this._strikeController;e.completeStepSignal.once(w,this._playResult,this);const{scene:t,gameView:s,constraintComponent:n}=this._params;e.start({scene:t,gameView:s,constraintComponent:n})}_playResult(e){e?this._hideLvl():this._resetRound()}_hideLvl(){console.log("WIN"),this._models.enemyModel.increaseLvl();const{gameView:e,scene:t}=this._params,s=this._hideLvlController;s.completeStepSignal.once(w,this._playShowLvl,this),s.start({gameView:e,scene:t})}_resetRound(){const{gameView:e,scene:t,constraintComponent:s}=this._params,n=this._resetRoundController;n.completeStepSignal.once(w,this._playNextRound,this),n.start({gameView:e,constraintComponent:s,scene:t})}_playNextRound(){const{gameView:e,pointerComponent:t,constraintComponent:s,scene:n}=this._params,i=this._userActionController;i.completeStepSignal.once(w,this._playStrike,this),i.start({gameView:e,pointerComponent:t,constraintComponent:s,scene:n,isFirst:this._firstRound})}}class ae{constructor(){t(this,"pointer"),t(this,"_isDragging",!1)}startDrag(){this._isDragging=!0}endDrag(){this._isDragging=!1}get isDragging(){return this._isDragging}}class re{constructor(){t(this,"_constraint"),t(this,"_pos")}createConstraint(e,t,s){return this._constraint=s.matter.add.constraint(e,t,0,.02),this._constraint}setPosition(e,t){this._pos=new Phaser.Math.Vector2(e,t)}getPosition(){return this._pos}get constraint(){return this._constraint}pauseUpdate(){}}class le extends n.Scene{constructor(){super("Game"),t(this,"camera"),t(this,"_scale",1)}create(){this.matter.world.engine.positionIterations=4,this.camera=this.cameras.main,this.scale.on("resize",this.resize,this),this.resize({width:window.innerWidth,height:window.innerHeight}),this.add.rectangle(0,0,a,r,16777215).setOrigin(0),this._createGame()}_createGame(){const e=(new L).buildUi({scene:this}),t=new re,s=new ae;(new oe).start({gameView:e,pointerComponent:s,constraintComponent:t,scene:this})}resize(e){const{width:t,height:s}=e,n=t,i=s,o=a,l=r,h=this._scale=Math.min(n/o,i/l);this.cameras.main.setZoom(h),this.cameras.main.centerOn(1024,768)}zoomTo(e,t,s){this.camera.zoomTo(this._scale*e,t,s)}setZoom(e){this.cameras.main.setZoom(this._scale*e)}}class he extends n.Scene{constructor(){super("MainMenu"),t(this,"background"),t(this,"logo"),t(this,"title")}create(){this.background=this.add.image(512,384,"background"),this.logo=this.add.image(512,300,"logo"),this.title=this.add.text(512,460,"Main Menu",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("Game")}))}}class ce extends n.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const e=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(t=>{e.width=4+460*t}))}preload(){this.load.json("lvls","data/lvls.json"),this.load.setPath("assets"),this.load.image("cloud1","game/Cloud_1.png"),this.load.image("cloud2","game/Cloud_2.png"),this.load.image("hills1","game/Hills_1.png"),this.load.image("hills2","game/Hills_2.png"),this.load.image("gameBg","game/bg_tile.png"),this.load.image("logo","logo.png"),this.load.image("bgTile","game/GrassCliffMid.png"),this.load.image("saw","game/Saw.png"),this.load.image("brick_tile","game/brick_tile.png"),this.load.image("slingshot_bottom","game/slingshotPoint_b.png"),this.load.image("slingshot_top","game/slingshotPoint_t.png"),this.load.image("slingshotPoint_point","game/slingshotPoint_point.png"),this.load.image("rope","game/rope.png"),this.load.image("chest","game/chest.png"),this.load.image("enemy","game/enemy.png"),this.load.image("mace","game/Mace.png"),this.load.image("spark","game/spark.png")}create(){this.scene.start("MainMenu")}}const pe={type:n.AUTO,width:a,height:r,parent:"game-container",backgroundColor:"#028af8",physics:{default:"matter",matter:{gravity:{y:1,x:0},debug:!1}},scene:[i,ce,he,le,o],scale:{mode:Phaser.Scale.NONE,autoCenter:Phaser.Scale.NO_CENTER}};document.addEventListener("DOMContentLoaded",(()=>{(()=>{const e=new n.Game({...pe,parent:"game-container"});e.scale.resize(window.innerWidth,window.innerHeight),window.addEventListener("resize",(()=>{e.scale.resize(window.innerWidth,window.innerHeight)}))})()}));
